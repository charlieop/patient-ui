import{i as c,j as u,ae as y}from"./BK4hmxeT.js";const{getSession:i,setSession:w,setExpiryTime:l,clearSession:S,getLang:v,setSummaryCode:_}=y(),a="https://4414-143-89-191-4.ngrok-free.app",k=()=>{const o=c([]),r=c(0),p=u(()=>o.value),h=u(()=>r.value);async function f(t){const e=await fetch(`${a}/patient/confirmForm/`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({...t,language:v()})}).then(s=>s.json()).catch(s=>(console.error(s),null));if(console.log(e),!e)return!1;const n=new Date(e.expire_time);return w(e.session,n),o.value.push({role:"user",content:e.content_user}),o.value.push({role:"assistant",content:e.content_assistant}),!0}async function d(t){o.value.push({role:"user",content:t}),r.value=1;const e=await fetch(`${a}/patient/chat/`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({session:i(),content:t})}).then(s=>s.json()).catch(s=>(console.error(s),r.value=-1,null));if(!e)return!1;console.log(e),o.value.push({role:"assistant",content:e.content});const n=new Date(e.expire_time);return l(n),e.is_finished?r.value=2:r.value=0,e.is_finished}async function g(t){const e=await fetch(`${a}/patient/endChat/`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({session:i(),modified_summary:t})}).then(n=>n.json()).catch(n=>(console.error(n),null));return console.log(e),e?(_(e.patient_code),S(),!0):!1}async function m(){const t=await fetch(`${a}/patient/getConHistory/`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({session:i()})}).then(n=>n.json()).catch(n=>(console.error(n),null));if(console.log(t),!t)return!1;o.value=t.conversation.map(n=>({...n,role:n.role}));const e=new Date(t.expire_time);return l(e),t.is_finished}return{messages:p,status:h,sendMessage:d,sendForm:f,loadHistory:m,sendModifiedSummary:g}};export{k as u};
